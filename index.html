<!DOCTYPE html>
<html>
<head>
  <title>Meatps Auction</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: Arial;
      margin: 0;
      padding-bottom: 70px;
      background: #f2f2f2;
      text-align: center;
    }

    .container {
      padding: 20px;
    }

    .card {
      background: white;
      padding: 15px;
      margin: 10px auto;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    input, button {
      padding: 8px;
      margin: 5px;
    }

    .chat-box {
      height: 200px;
      overflow-y: auto;
      text-align: left;
      background: #fff;
      padding: 10px;
      border-radius: 8px;
    }

    .bottom-menu {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: #222;
      display: flex;
      justify-content: space-around;
      padding: 10px 0;
      color: white;
    }

    .menu-btn {
      cursor: pointer;
    }

    .hidden {
      display: none;
    }
  </style>
</head>

<body>

<div id="lelang" class="container">
  <h2>ğŸ“¦ Meatps Auction</h2>

  <div class="card">
    <h3 id="itemName">Item: -</h3>
    <p id="itemJumlah">Jumlah: -</p>
    <p>â³ <span id="timer">0</span> detik</p>
    <h3>ğŸ’ <span id="highestBid">0</span> BGL</h3>
    <p>ğŸ‘¤ <span id="highestBidder">-</span></p>
  </div>

  <div class="card">
    <input id="growid" placeholder="GrowID">
    <input id="bidAmount" type="number" placeholder="Jumlah BGL">
    <button onclick="placeBid()">Bid</button>
  </div>

  <div class="card">
    <h4>Riwayat Bid</h4>
    <div id="bidList"></div>
  </div>
</div>

<div id="chat" class="container hidden">
  <h2>ğŸ—£ï¸ Live Chat</h2>

  <div class="card">
    <div id="chatBox" class="chat-box"></div>
    <input id="chatName" placeholder="Nama">
    <input id="chatMsg" placeholder="Pesan">
    <button onclick="sendChat()">Kirim</button>
  </div>
</div>

<div id="owner" class="container hidden">
  <h2>ğŸ“„ Owner Panel</h2>

  <div id="loginBox">
    <input type="password" id="ownerPass" placeholder="Password">
    <button onclick="loginOwner()">Login</button>
  </div>

  <div id="ownerPanel" class="hidden">
    <div class="card">
      <input id="setItem" placeholder="Nama Item">
      <input id="setJumlah" placeholder="Jumlah Item">
      <input id="setWaktu" type="number" placeholder="Durasi (detik)">
      <button onclick="setAuction()">Start Lelang</button>
    </div>
  </div>
</div>

<div class="bottom-menu">
  <div class="menu-btn" onclick="showPage('lelang')">ğŸ“¦ Lelang</div>
  <div class="menu-btn" onclick="showPage('chat')">ğŸ—£ï¸ Livechat</div>
  <div class="menu-btn" onclick="showPage('owner')">ğŸ“„ Owner ACC</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, set, push, onValue, update } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyC8QrDc5NiyyEZwl8sqBSVEPkymTkpgOiU",
  authDomain: "leetopia-auction.firebaseapp.com",
  databaseURL: "https://leetopia-auction-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "leetopia-auction",
  storageBucket: "leetopia-auction.firebasestorage.app",
  messagingSenderId: "396746559389",
  appId: "1:396746559389:web:21fa42ddc49366b6106974"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

window.showPage = function(page){
  document.getElementById("lelang").classList.add("hidden");
  document.getElementById("chat").classList.add("hidden");
  document.getElementById("owner").classList.add("hidden");
  document.getElementById(page).classList.remove("hidden");
}

window.placeBid = function(){
  let name = document.getElementById("growid").value;
  let amount = document.getElementById("bidAmount").value;

  if(!name || !amount) return;

  push(ref(db,"bids"), {
    name: name,
    amount: parseInt(amount)
  });
}

onValue(ref(db,"bids"), snapshot=>{
  let data = snapshot.val();
  let highest = 0;
  let bidder = "-";
  let list = "";

  for(let id in data){
    list += `<p>${data[id].name} : ${data[id].amount} BGL</p>`;
    if(data[id].amount > highest){
      highest = data[id].amount;
      bidder = data[id].name;
    }
  }

  document.getElementById("highestBid").innerText = highest;
  document.getElementById("highestBidder").innerText = bidder;
  document.getElementById("bidList").innerHTML = list;
});

window.setAuction = function(){
  let item = document.getElementById("setItem").value;
  let jumlah = document.getElementById("setJumlah").value;
  let waktu = document.getElementById("setWaktu").value;

  set(ref(db,"auction"), {
    item: item,
    jumlah: jumlah,
    time: parseInt(waktu)
  });

  set(ref(db,"bids"), null);
}

onValue(ref(db,"auction"), snapshot=>{
  let data = snapshot.val();
  if(!data) return;

  document.getElementById("itemName").innerText = "Item: " + data.item;
  document.getElementById("itemJumlah").innerText = "Jumlah: " + data.jumlah;
  document.getElementById("timer").innerText = data.time;

  let time = data.time;
  setInterval(()=>{
    if(time > 0){
      time--;
      document.getElementById("timer").innerText = time;
    }
  },1000);
});

window.loginOwner = function(){
  let pass = document.getElementById("ownerPass").value;
  if(pass === "12345"){
    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("ownerPanel").classList.remove("hidden");
  }else{
    alert("Password salah!");
  }
}

window.sendChat = function(){
  let name = document.getElementById("chatName").value;
  let msg = document.getElementById("chatMsg").value;
  if(!name || !msg) return;

  push(ref(db,"chat"), {
    name:name,
    msg:msg
  });
}

onValue(ref(db,"chat"), snapshot=>{
  let data = snapshot.val();
  let list="";
  for(let id in data){
    list+=`<p><b>${data[id].name}</b>: ${data[id].msg}</p>`;
  }
  document.getElementById("chatBox").innerHTML=list;
});
</script>

</body>
</html>
