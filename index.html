<!DOCTYPE html>
<html>
<head>
  <title>Leetopia Auction Website</title>

  <!-- Firebase v8 (simple version) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <style>
    body {
      font-family: Arial;
      background:#111;
      color:white;
      text-align:center;
    }

    .box {
      background:#222;
      padding:20px;
      margin:20px auto;
      border-radius:10px;
      width:90%;
      max-width:500px;
    }

    input, button {
      padding:8px;
      margin:5px;
      border-radius:5px;
      border:none;
    }

    button {
      background:gold;
      cursor:pointer;
      font-weight:bold;
    }

    button:hover {
      background:orange;
    }
  </style>
</head>

<body>

<h1>Leetopia Auction Website</h1>

<div class="box">
  <h2>Owner Panel</h2>
  <input type="password" id="ownerPass" placeholder="Owner Password">
  <button onclick="loginOwner()">Login</button>

  <div id="ownerControls" style="display:none;">
    <input type="text" id="itemName" placeholder="Item Name"><br>
    <input type="number" id="itemQty" placeholder="Jumlah Item"><br>
    <input type="number" id="startPrice" placeholder="Start Price (BGL)"><br>
    <input type="number" id="duration" placeholder="Durasi (menit)"><br>
    <button onclick="startAuction()">Start Auction</button>
  </div>
</div>

<div class="box">
  <h2 id="itemDisplay">Belum ada lelang</h2>
  <h3 id="timer"></h3>

  <h3>Highest Bid: <span id="highestBid">0</span> BGL</h3>
  <h3>Bidder: <span id="highestBidder">-</span></h3>

  <input type="text" id="growId" placeholder="Masukkan GrowID"><br>
  <input type="number" id="bidAmount" placeholder="Masukkan Bid (BGL)"><br>
  <button onclick="placeBid()">Bid</button>

  <h3>Bid History</h3>
  <div id="bidHistory"></div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyC8QrDc5NiyyEZwl8sqBSVEPkymTkpgOiU",
  authDomain: "leetopia-auction.firebaseapp.com",
  databaseURL: "https://leetopia-auction-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "leetopia-auction",
  storageBucket: "leetopia-auction.firebasestorage.app",
  messagingSenderId: "396746559389",
  appId: "1:396746559389:web:21fa42ddc49366b6106974"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const OWNER_PASSWORD = "12345";

function loginOwner(){
  if(document.getElementById("ownerPass").value === OWNER_PASSWORD){
    document.getElementById("ownerControls").style.display="block";
    alert("Owner Login Success");
  } else {
    alert("Wrong Password");
  }
}

function startAuction(){
  const name = document.getElementById("itemName").value;
  const qty = document.getElementById("itemQty").value;
  const start = parseInt(document.getElementById("startPrice").value);
  const duration = parseInt(document.getElementById("duration").value);

  const endTime = Date.now() + duration * 60000;

  db.ref("auction").set({
    itemName:name,
    itemQty:qty,
    highestBid:start,
    highestBidder:"-",
    endTime:endTime
  });

  db.ref("bids").remove();
}

function placeBid(){
  const growId = document.getElementById("growId").value;
  const amount = parseInt(document.getElementById("bidAmount").value);

  db.ref("auction").once("value", snap=>{
    const data = snap.val();
    if(!data) return;

    if(amount > data.highestBid){
      db.ref("auction").update({
        highestBid:amount,
        highestBidder:growId
      });

      db.ref("bids").push({
        growId:growId,
        amount:amount
      });
    } else {
      alert("Bid harus lebih tinggi dari highest bid!");
    }
  });
}

db.ref("auction").on("value", snap=>{
  const data = snap.val();
  if(!data) return;

  document.getElementById("itemDisplay").innerHTML =
    data.itemName + " (x" + data.itemQty + ")";

  document.getElementById("highestBid").innerHTML = data.highestBid;
  document.getElementById("highestBidder").innerHTML = data.highestBidder;

  const interval = setInterval(()=>{
    const remaining = data.endTime - Date.now();
    if(remaining <= 0){
      document.getElementById("timer").innerHTML = "Auction Ended";
      clearInterval(interval);
    } else {
      document.getElementById("timer").innerHTML =
        "Time Left: " + Math.floor(remaining/60000) + "m " +
        Math.floor((remaining%60000)/1000) + "s";
    }
  },1000);
});

db.ref("bids").on("child_added", snap=>{
  const bid = snap.val();
  const div = document.createElement("div");
  div.innerHTML = bid.growId + " bid " + bid.amount + " BGL";
  document.getElementById("bidHistory").prepend(div);
});
</script>

</body>
</html>
